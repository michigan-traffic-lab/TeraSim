# Autoware Co-Simulation

This guide explains how to connect Autoware's simple planning simulator to traffic actors including vehicles and traffic lights generated by TeraSim.

### Additional Requirements

- __Hardware__: A CPU based on Intel x86 architecture with at least 16 cores, at least 16 GB of system memory, and a dedicated GPU with at least 8 GB of VRAM.

### Additional Dependency

- [__Autoware__](https://github.com/michigan-traffic-lab/autoware): Follow the installation instructions for the mcity-dedicated version of autoware until you can successfully run the provided short demonstration. This step may take 4-6 hours.

## Run Autoware Co-Simulation

Run the autoware co-simulation auxiliary scripts. This synchronizes background vehicles and traffic light states from TeraSim to Autoware, and synchronizes CAV information from Autoware back to TeraSim.

```bash
ros2 launch autoware_cosim sim.launch.py
```

Start the autoware simulation stack. Use 2D Pose Estimate to initialize the vehicle and 2D Goal pose to select a destination for path planning:

```bash
ros2 launch autoware_launch planning_simulator.launch.xml map_path:=$HOME/autoware/map vehicle_model:=sample_vehicle sensor_model:=sample_sensor_kit lanelet2_map_file:=lanelet2_mcity_v43.osm
```

Run the TeraSim scripts by selecting one of the following options:
```bash
# 1.Naturalistic and Adversarial Driving Simulation (https://www.nature.com/articles/s41467-021-21007-8)
python3 safetest_nade_example.py

# 2.SUMO controlled vehicle simulation 
python3 default_sumo_example.py

# 3.SUMO controlled pedestrian simulation 
python3 pedestrian_example.py

# 4.SUMO controlled bicycle and motorcycle simulation 
python3 cyclist_example.py
```

